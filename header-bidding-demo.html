<html>

<head>

<script>

	var pbjs = pbjs || {},
	PREBID_TIMEOUT = 600;

    // logs will track events by the time it occured. e.g. {""}
    var logs = {
        'Load Prebid.js': {static: true},
        'Adserver Timer': {static: true},
        'amazon': {},
        'appnexus': {},
        'criteo': {},
        'openx': {},
        'pubmatic': {},
        'rubicon': {},
        'Load GPT': {static: true},
        'Set Targeting': {static: true},
    };

	/* 1. Register bidder tag Ids

    Registers the bidder tags for your ad units. Once the prebid.js 
    library loads, it reads the pbjs.adUnits object and sends out 
    bid requests. Find the complete reference on bidders at 
    http://prebid.org/bidders.html.

    code:  Your GPT slot’s ad unit path. If they don’t match, prebid.js 
           would not be able to set targeting correctly
    sizes: All sizes your ad unit accepts. They should match with GPT.

    */
	pbjs.adUnits = [{
        code: '/19968336/header-bid-tag-0',
        sizes: [[300, 250], [300, 600]],
        bids: [
            // 1 ad unit can be targeted by multiple bids.
            {
                bidder: 'appnexus',
                params: {
                   placementId: '4799418'
                }
            }, 
            {
                bidder: 'amazon',
                params: {
                   aaxId: 'random-id'
                }
            }, 
            // 1 ad unit can also be targeted by multiple bids from 1 bidder
            {
                bidder: 'pubmatic',
                params: {
                    publisherId: 39741,
                    adSlot: '123456789@300x250'
                }
            },
            {
                bidder: 'criteo',
                params: {
                    nid: "random-id",
                    cookiename: "cto_test"
                }
            },
            {
                bidder: 'openx',
                params: {
                    unit: 123456789,
                    //unit: 537245128,
                    jstag_url : 'http://prebid.org/assets/js/ox-d.js'
                }
            },{
                bidder: 'rubicon',
                params: {
                   rp_account : '1234',
                   rp_site: '12345',
                   rp_zonesize : '1234-15',
                   rp_tracking : 'affiliate-1701207318',
                   rp_floor : '0.1'
                }
            }

            ]
    }];

  
    /* 2. Configure Ad Server Targeting

    The below section defines what key value targeting will be sent to GPT. 
    For each bidder’s bid, Prebid.js will set the below 4 keys (hb_bidder, 
    hb_adid, hb_pb, hb_size) with their corresponding values.

    Bidders all have different recommended ad server line item targeting and 
    creative setup. To remove the headache for you, Prebid.js has a default 
    recommended query string targeting setting for all bidders.

    If you’d like to customize the key value pairs, you can overwrite the settings 
    as the below example shows. Let your ad ops team know about the change, so they 
    can update the line item targeting accordingly.

    */
    
    pbjs.bidderSettings = {
        standard: {
            adserverTargeting: [{
                key: "hb_bidder",
                val: function(bidResponse) {
                    return bidResponse.bidderCode;
                }
            }, {
                key: "hb_adid",
                val: function(bidResponse) {
                    return bidResponse.adId;
                }
            }, {
                key: "hb_pb",
                val: function(bidResponse) {
                    return bidResponse.pbLg;
                }
            }]
        }
    };

    //  Optional callback handler that will get called when all bidders' bids are available.
    pbjs.registerBidCallbackHandler = function(){
        initAdserver();
    };

    pbjs.beforeCallBidder = function(bidderCode) {
        setScriptLog(bidderCode, 'start');
    }
    pbjs.bidderRawBidsBack = function(bidderCode) {
        setScriptLog(bidderCode, 'end');   
    }

    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    
    var timeInit = new Date().getTime();
    
    window.setScriptLog = function(name, ev) {
        if (!(name in logs)) logs[name] = {};
        logs[name][ev] = new Date().getTime() - timeInit;
    }

    function initAdserver() {
        if (pbjs.initAdserverSet) return;

        //load GPT library here
        setScriptLog('Adserver Timer', 'end');

        setScriptLog('Load GPT', 'start');

        (function() {
            var gads = document.createElement('script');
            gads.async = true;
            gads.type = 'text/javascript';
            var useSSL = 'https:' == document.location.protocol;
            gads.src = (useSSL ? 'https:' : 'http:') +
            '//www.googletagservices.com/tag/js/gpt.js';
            var node = document.getElementsByTagName('script')[0];
            node.parentNode.insertBefore(gads, node);
        })();
        pbjs.initAdserverSet = true;
    };

    setScriptLog('Adserver Timer', 'start');
    // Load GPT when timeout is reached.
    setTimeout(initAdserver, PREBID_TIMEOUT);

    


    // Load the Prebid Javascript Library Async. We recommend loading it immediately after
    // the initAdserver() and setTimeout functions.
    (function() {
        setScriptLog('Load Prebid.js', 'start');

        var pbjsEl = document.createElement("script"); pbjsEl.type = "text/javascript";
        pbjsEl.src = '/assets/js/prebid.js';
        var pbjsTargetEl = document.getElementsByTagName("head")[0];
        pbjsTargetEl.insertBefore(pbjsEl, pbjsTargetEl.firstChild);

        setScriptLog('Load Prebid.js', 'end');
    })();

</script>


<script>
    googletag.cmd.push(function() {

        //setScriptLog('Load GPT', 'end');
        logs['Load GPT']['end'] = new Date().getTime() - timeInit;

        var rightSlot = googletag.defineSlot('/19968336/header-bid-tag-0', [[300, 250], [300, 600]], 'div-gpt-ad-1438287399331-0').addService(googletag.pubads());

        /* Set query string targeting on all GPT ad units. The logic for deciding query strings is described in the section Configure AdServer Targeting. Note that this function has to be called after all ad units on page are defined.
        */
        if (pbjs.libLoaded) pbjs.setTargetingForGPTAsync();

        setScriptLog('Set Targeting', 'start');

        // The below writes out the targeting params and bid responses for available bids
        if (pbjs.libLoaded) {
            console.log('Are all bids available? : ' + pbjs.allBidsAvailable()); // return bool

            console.log('Targeting params:')
            console.log(pbjs.getAdserverTargetingParamsForAdUnit());

            console.log('Dumping all bid objects to console:');
            console.log(pbjs.getBidResponses()); // or pass a code to get one particular ad unit

            var bids = JSON.parse(pbjs.getBidResponses('/19968336/header-bid-tag-0')).bids;
            for (var i in bids) {
                var bid = bids[i];
                if (!(bid.bidderCode in logs)) continue;

                logs[bid.bidderCode]['cpm'] = bid.cpm;
            }

            console.log('hey');
            console.log(logs);

            setTimeout(function() {
                window.top.logTime(logs, (new Date().getTime() - timeInit));
            }, 500);


        }

        setScriptLog('Set Targeting', 'end');

        googletag.pubads().enableSingleRequest();
        googletag.enableServices();   
        
    });

    // Apply the newly refreshed pre-bid targeting to GPT. Call GPT refresh.
    function callGPT(){
        pbjs.setTargetingForGPTAsync();
        googletag.pubads().refresh(); 
    }

    /* Request bids for all ad units. Clear all previous pre-bid requests' targeting.
       Make GPT wait for PREBID_TIMEOUT amount of time before callGPT().
    */
    function refreshBids(){
        pbjs.requestBidsForAdUnit();
        setTimeout(callGPT, PREBID_TIMEOUT);
    }



    </script>
</head>


<body style="padding:0;margin:0">
    
    <!-- /19968336/pbjs-right1-300x250-300x600 -->
    <div id='div-gpt-ad-1438287399331-0'>
        <script type='text/javascript'>
            googletag.cmd.push(function() { googletag.display('div-gpt-ad-1438287399331-0'); });
        </script>
    </div>

</body>

</html>