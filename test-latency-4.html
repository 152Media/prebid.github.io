
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="_SMhyxJ4MnU9eTUQQNMUwU5W18T5tjNF7A6mumIci-A" />
  <meta name="keywords" content="Header Bidding, Advanced Bidding, Header Bid, Pre-bid">
  <meta name="description" content="An ad ops guide for implementing header bidding with prebid.js." />

  
    <title>Ad Ops Guide for Header Bidding</title>
  
  <script>

  var clog = function(s) {
    //console.log(s);
  }

    var pbjsTimestamps = {slots:[], bidders:{}};
    pbjsTimestamps.init = new Date().getTime();

    setTimeout(function(){

      // Submit data to Parse
      var Timelog = Parse.Object.extend("Timelog");

      var timelog = new Timelog();
      timelog.set('placementCount', 2);
      timelog.set('bidCount', 1);

      var frontMarkedTime = pbjsTimestamps.frontMarked - pbjsTimestamps.init;
      clog(frontMarkedTime);

      timelog.set("frontMarked", frontMarkedTime);

      timelog.set('bidsTime', pbjsTimestamps.bidsBack - pbjsTimestamps.init);
      
      timelog.set('adserverCalled', pbjsTimestamps.adserverCalled);
      timelog.set('adserverSet', pbjsTimestamps.adserverSet);
      timelog.set('revenue', pbjsTimestamps.revenue);
      timelog.set('timeout', pbjs.PREBID_TIMEOUT);

      timelog.set('version', 3);

      for (var i = 0; i < pbjsTimestamps.slots.length; i++) {
        var slot = pbjsTimestamps.slots[i];
        var code = slot.code;
        var slotRenderedTime = slot.rendered - pbjsTimestamps.init;
        clog(code + ' : ' + slotRenderedTime);

        timelog.set("slot" + i, slotRenderedTime);
      }


      // var Bidder = Parse.Object.extend("Bidder");
      // for (var i = 0; i < pbjsTimestamps.bidders.length; i++) {
      //   var b = pbjsTimestamps.bidders[i];
      //   var bidder = new Bidder();
      //   bidder.set('bidderCode', b.bidderCode);
      // }
      
      timelog.save(null, {
        success: function(timelog) {
          document.location.href = '/test-latency-3.html';
        },
        error: function(timelog, error) {
          clog(error);
        }
      });


    }, 5000)
  </script>

  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="http://prebid.org/assets/css/docs.min.css" rel="stylesheet">
  <link href="http://prebid.org/assets/css/style.css" rel="stylesheet">

  <style>
    #content {
      background:#3b88c3;
      background:linear-gradient(135deg, #3b88c3, );
    }
  </style>

  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.5.0.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min.js"></script>
  <script src="http://prebid.org/assets/js/docs.min.js"></script>
  <script type="text/javascript" src="http://prebid.org/assets/js/pbjs_home.js"></script>



  <script>

    var pbjs = pbjs || {};

    pbjs.getTestTimeout = function() {
      // between 0 and 11 * 100
      //return (Math.floor(Math.random() * 12))*100;
      return 1000;
    }
    pbjs.PREBID_TIMEOUT = pbjs.getTestTimeout();


    //PREBID_TIMEOUT = 1000;

      pbjs.adUnits = [{
            code: '/19968336/header-bid-tag-0',
            sizes: [[300, 250], [300, 600]],
            bids: [
                // 1 ad unit can be targeted by multiple bids.
                ///*
                {
                    bidder: 'appnexus',
                    params: {
                       placementId: '3282718'
                    }
                }

                ]
        },{
            code: '/19968336/header-bid-tag1',
            sizes: [[728, 90], [970, 90]],
            bids: [
                {
                    bidder: 'appnexus',
                    params: {
                       placementId: '3282718'
                    }
                }
                ]
        }];

        pbjs.bidderSettings = {
            standard: {
                adserverTargeting: [{
                    key: "hb_bidder",
                    val: function(bidResponse) {
                        return bidResponse.bidderCode;
                    }
                }, {
                    key: "hb_adid",
                    val: function(bidResponse) {
                        return bidResponse.adId;
                    }
                }, {
                    key: "hb_pb",
                    val: function(bidResponse) {
                        return bidResponse.pbLg;
                    }
                }]
            }
        };

        pbjs.registerBidCallbackHandler = function(){
            pbjsTimestamps.bidsBack = new Date().getTime();
            initAdserver();
        };

        pbjs.creativeBackHandler = function(adId) {
          //alert(adId);
          pbjsTimestamps.slots.push({
            code: adId,
            rendered: new Date().getTime()
          });
        };

        pbjs.beforeCallBidder = function(bidderCode) {
            //setScriptLog(bidderCode, 'start');
        }
        pbjs.bidderRawBidsBack = function(bidderCode) {
            //setScriptLog(bidderCode, 'end');   
        }

        function logRev() {
          // Get the revenue
          var rev = 0;

          if (pbjs.libLoaded) {
            var allBids = pbjs.getBidResponses();
            for (var code in allBids) {
              if ('bids' in allBids[code]) {
                var bids = allBids[code].bids;  
                
                var hp = 0.0000;

                for (var i = 0; i < bids.length; i++) {
                  var bid = bids[i];
                  if ('cpm' in bid && bid.cpm > hp) {
                    hp = bid.cpm;
                  }
                }
                
                rev += hp;
              }
              
            }
          }
          
          clog('revenue made: ' + rev);
          pbjsTimestamps.revenue = rev;
        }

        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];
        
        function initAdserver() {
            if (pbjs.initAdserverSet) return;
            pbjsTimestamps.adserverCalled = new Date().getTime() - pbjsTimestamps.init;
            clog('initAdserver called at: ' + pbjsTimestamps.adserverCalled);


            //load GPT library here
            (function() {
                var gads = document.createElement('script');
                gads.async = true;
                gads.type = 'text/javascript';
                var useSSL = 'https:' == document.location.protocol;
                gads.src = (useSSL ? 'https:' : 'http:') +
                '//www.googletagservices.com/tag/js/gpt.js';
                var node = document.getElementsByTagName('script')[0];
                node.parentNode.insertBefore(gads, node);
            })();
            pbjs.initAdserverSet = true;
        };
        // Load GPT when timeout is reached.

        pbjsTimestamps.adserverSet = new Date().getTime() - pbjsTimestamps.init;
        setTimeout(initAdserver, pbjs.PREBID_TIMEOUT);
        clog('initAdserver timeout set at: ' + pbjsTimestamps.adserverSet);

        // Load the Prebid Javascript Library Async. We recommend loading it immediately after
        // the initAdserver() and setTimeout functions.
        
        (function() {
            var pbjsEl = document.createElement("script"); pbjsEl.type = "text/javascript";
            pbjsEl.async = true; var isHttps = 'https:' === document.location.protocol;
            pbjsEl.src = (isHttps ? "https://a248.e.akamai.net/appnexus.download.akamai.com/89298/adnexus-prod" : "http://cdn.adnxs.com") + "/tag/v/prebid/0.1.1/prebid.js";
            var pbjsTargetEl = document.getElementsByTagName("head")[0];
            //setTimeout(function() {pbjsTargetEl.insertBefore(pbjsEl, pbjsTargetEl.firstChild);}, 0)
            pbjsTargetEl.insertBefore(pbjsEl, pbjsTargetEl.firstChild);
        })();

        googletag.cmd.push(function() {

            var rightSlot = googletag.defineSlot('/19968336/header-bid-tag-0', [[300, 250], [300, 600]], 'div-gpt-ad-1438287399331-0').addService(googletag.pubads());

            var topSlot = googletag.defineSlot('/19968336/header-bid-tag1', [[728, 90], [970, 90]], 'div-gpt-ad-1438287399331-1').addService(googletag.pubads());

            /* Set query string targeting on all GPT ad units. The logic for deciding query strings is described in the section Configure AdServer Targeting. Note that this function has to be called after all ad units on page are defined.
            */
            logRev();

            if (pbjs.libLoaded) pbjs.setTargetingForGPTAsync();

            

            // The below writes out the targeting params and bid responses for available bids
            
            /*
            if (pbjs.libLoaded) {
                clog('Are all bids available? : ' + pbjs.allBidsAvailable()); // return bool

                clog('Targeting params:')
                clog(JSON.stringify(pbjs.getAdserverTargetingParamsForAdUnit()));

                //clog('Dumping all bid objects to console:');
                clog(JSON.stringify(pbjs.getBidResponses())); // or pass a code to get one particular 
            }
            */
            clog(pbjs.getBidResponses());
            
            /*
            googletag.pubads().addEventListener('slotRenderEnded', function(event) {
                  //clog('Slot has been rendered:');
                  //clog(event);
                  pbjsTimestamps.slots.push({
                    code: event.slot.getSlotId().getAdUnitPath(),
                    rendered: new Date().getTime()
                  });
                  //clog(pbjsTimestamps);
                });
            */

            googletag.pubads().enableSingleRequest();
            googletag.enableServices();   
        });

  </script>
</head>

<body>


    <h5>Div-2, 728x90 or 970x90</h5>
    <!-- /19968336/PBJS-top-728x90-970x90 -->
    <div id='div-gpt-ad-1438287399331-1'>
        <script type='text/javascript'>
            googletag.cmd.push(function() { googletag.display('div-gpt-ad-1438287399331-1'); });
        </script>
    </div>



  <!-- Main navigation
  =========================================== -->
  <header class="navbar navbar-static-top bs-docs-nav" id="top">
    <div class="container">
      <div class="navbar-header" role="banner">
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://prebid.org/">Prebid.js</a>
      </div>
      <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
        <ul class="nav navbar-nav">
        
        
          
        
          
        
          
        
          
          <li >
            <a href="http://prebid.org/getting-started.html">Getting Started
              
            </a>
          </li>
          
        
          
          <li >
            <a href="http://prebid.org/publisher-api.html">Publisher API
              
            </a>
          </li>
          
        
          
        
          
          <li class="active">
            <a href="http://prebid.org/adops.html">Ad Ops Guide
              
            </a>
          </li>
          
        
          
        
          
          <li >
            <a href="http://prebid.org/addme.html">Add me!
              
                <span class="label label-warning">New!</span>
              
            </a>
          </li>
          
        
          
        
        </ul>
        <ul class="nav navbar-nav navbar-right">
        
          <li>
            <a href="/blog.html">Blog</a>
          </li>
        
          <li>
            <a href="https://github.com/prebid/Prebid.js">GitHub</a>
          </li>
        
        </ul>
      </nav>
    </div>
  </header>


  <!-- Header
  =========================================== -->

  <div class="bs-docs-header" id="content">
    <div class="container">
      <h1>Ad Ops Guide</h1>
      <p>An ad ops guide for implementing header bidding with prebid.js.</p>
    </div>
  </div>


  <div class="container bs-docs-container">
    <div class="row">
      <!-- Content
      =========================================== -->
      <div class="col-md-9" role="main">
        <div class="bs-docs-section">

  <h1 id="overview">Overview</h1>

  <blockquote>
    <p><strong>Prebid.js</strong> brings header bidding, and thus <strong>dynamic-allocation-like</strong> functionality to <strong>all</strong> SSPs and other programmatic partners.</p>
  </blockquote>

  <p>If you spend an absurd about of time reviewing SSP reports to figure out which one makes you the most money, or are sick of dealing with passbacks on SSPs that can’t fill all your inventory – say hi to Prebid.js.</p>

  <p>In an ideal world, every one of your SSPs would work similarly to dynamic allocation, where everything competes on price and is handled by your ad server. </p>

  <p>Prebid.js empowers publishers to create dynamic-allocation-like functionality for SSPs and other programmatic partners. Each partner competes on price for every impression at the same time, eliminating “first look” and “waterfalls” to help make publishers more money. </p>

  <p>The result? More transparency into market demand, more control over the bid process, and a greater array of advertiser demand.</p>

</div>

<div class="bs-docs-section">

  <h1 id="how-does-it-work">How does it work?</h1>

  <p><img src="http://prebid.org/assets/images/adops-intro.png" alt="Ad Ops Diagram" /></p>

  <h5 id="bidders">1. Bidders</h5>
  <ul>
    <li>You configure prebid.js and setup one or more supported “bidders” (SSP, retargeters, ad networks, etc. – whatever they’re called)</li>
    <li>As the page loads, prebid.js will asynchronously call each bidder to request how much they’re willing to pay for the impression. Note: the asynchronous calls mean the pages’ content continues to render without interruption.</li>
  </ul>

  <h5 id="timer-on-page">2. Timer on page</h5>
  <ul>
    <li>To allow time for prebid.js to run, a timer is wrapped around the ad server tags on page. When bids are returned, or the timer runs out, the ad call to the publisher’s ad server is made – with a little extra information piggybacked onboard.</li>
  </ul>

  <h5 id="ad-server-requests-with-key-value-targeting">3. Ad server requests with key-value targeting</h5>
  <ul>
    <li>When bids are received, prebid.js adds the bidder, size, price, and creative URL to your ad server’s call via key-values on the query string.</li>
  </ul>

  <h5 id="line-items">4. Line items</h5>
  <ul>
    <li>Within your ad server, line items are setup to target the various bid prices and sizes, allowing the bidders’ programmatic demand compete with other line items or integrated exchanges (like Google Ad Exchange) based on price. More details on price bucket and line item setup below.</li>
  </ul>

  <h5 id="creative">5. Creative</h5>
  <ul>
    <li>A small snippet of JavaScript is setup as a creative on each pre-bid line item. When a programmatic line item is picked by your ad server, the “creative” JS snippet tells prebid.js which bidder to serve. The short code snippet documented here handles all bidders and all sizes.</li>
  </ul>

  <p>Voila, you have dynamic allocation-like functionality for the major SSPs and exchanges.</p>

  <p><br /></p>

  <h4 id="what-key-value-targeting-does-prebidjs-return-to-your-ad-server">What key value targeting does prebid.js return to your ad server?</h4>

  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th style="text-align: left">Default Key</th>
        <th style="text-align: left">Scope</th>
        <th style="text-align: left">Description</th>
        <th style="text-align: left">Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align: left">hb_pb</td>
        <td style="text-align: left">Required</td>
        <td style="text-align: left">The price bucket. Used by the line item to target.</td>
        <td style="text-align: left"><code>2.10</code></td>
      </tr>
      <tr>
        <td style="text-align: left">hb_adid</td>
        <td style="text-align: left">Required</td>
        <td style="text-align: left">The ad Id. Used by the ad server creative to render ad.</td>
        <td style="text-align: left"><code>234234</code></td>
      </tr>
      <tr>
        <td style="text-align: left">hb_bidder</td>
        <td style="text-align: left">Required</td>
        <td style="text-align: left">The bidder code. Useful for logging and reporting to learn about which bidder has higher fill rate/CPM.</td>
        <td style="text-align: left"><code>rubicon</code></td>
      </tr>
      <tr>
        <td style="text-align: left">hb_size</td>
        <td style="text-align: left">Optional</td>
        <td style="text-align: left">The width and height concatenated.</td>
        <td style="text-align: left"><code>300x250</code></td>
      </tr>
      <tr>
        <td style="text-align: left">hb_cpm</td>
        <td style="text-align: left">Optional</td>
        <td style="text-align: left">The exact price the bidder bids for. It offers more accuracy than <code>hb_pb</code> and can be used by the line item to target.</td>
        <td style="text-align: left"><code>2.11</code></td>
      </tr>
    </tbody>
  </table>

  <p><a name="price-bucket-def"></a></p>

  <h4 id="price-bucket-definition">Price Bucket Definition</h4>

  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th style="text-align: left">bidResponse variable</th>
        <th style="text-align: left">Description</th>
        <th style="text-align: left">Example</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align: left"><code>pbLg</code></td>
        <td style="text-align: left">The low granularity price bucket at 0.50 increment, capped at $5, floored to 2 decimal places. (0.50, 1.00, 1.50, …, 5.00)</td>
        <td style="text-align: left"><code>1.50</code></td>
      </tr>
      <tr>
        <td style="text-align: left"><code>pbMg</code></td>
        <td style="text-align: left">The medium granularity price bucket at 0.10 increment, capped at $20, floored to 2 decimal places. (0.10, 0.20, …, 19.90, 20.00)</td>
        <td style="text-align: left"><code>1.60</code></td>
      </tr>
      <tr>
        <td style="text-align: left"><code>pbHg</code></td>
        <td style="text-align: left">The high granularity price bucket at 0.01 increment, capped at $20, floored to 2 decimal places. (0.01, 0.02, …, 19.99, 20.00)</td>
        <td style="text-align: left"><code>1.61</code></td>
      </tr>
    </tbody>
  </table>

</div>

<div class="bs-docs-section">

  <h1 id="getting-started">Getting Started</h1>

  <blockquote>
    <p>Here’s what you need to implement header bidding via Prebid.js </p>
  </blockquote>

  <h4 id="step-1-setup-a-test-page">Step 1: Setup a test page</h4>

  <p>Publishers who successfully implement Prebid.js typically start with a test page consisting of 2 ad units, for example 300x250 and 728x90.</p>

  <h4 id="step-2-decide-on-price-bucket-granularity">Step 2: Decide on price bucket granularity</h4>

  <p>With pre-bid, you’ll need to setup line items to tell your ad server how much money the “bidder” demand is worth to you. This process is done via key-values.</p>

  <p>Example:</p>

  <ul>
    <li>
      <p>Prebid.js is going to call your bidders for their price, then pass it into your ad server on the query-string. You want to target this bid price with a line item that earns you the same amount if it serves.</p>
    </li>
    <li>
      <p>If you had 1-line item for every bid at a penny granularity of $0.01, $0.02, $0.03, …, 1.23, …, $4.56 you’d need 1,000 line items just to represent bids from $0-$10. We call this the “Exact” granularity option.</p>
    </li>
    <li>
      <p>Creating 1,000 line items can be a hassle, so publishers typically use price buckets to represent price ranges that matter. For example, you could group bids into 10 cent increments, so bids of $1.06 or $1.02 would be rounded down into a single price bucket of $1.00.</p>
    </li>
  </ul>

  <p>Our recommendation is to start with $1 or 10 cent granularity until you’re more comfortable with Prebid.js. At $1, you only need to setup 10-20 line items – easy. When you’re ready, get more granular with the price buckets to improve yield.</p>

  <h4 id="step-3-sign-up-for-bidders">Step 3: Sign-up for bidders</h4>

  <p>To maximize earning potential, we recommend you sign-up for the various bidders prebid.js supports (more will be added):</p>

  <ul>
    <li>Amazon</li>
    <li>AppNexus</li>
    <li>Criteo</li>
    <li>Rubicon Project</li>
    <li>OpenX</li>
    <li>PubMatic</li>
  </ul>

  <h4 id="step-4-implement-prebidjs">Step 4: Implement Prebid.js</h4>

  <p>Work with your development team to implement prebid.js as documented in Publisher API. We recommend you start with one bidder. You’ll need an account with the bidder and will need to provide your developer with the bidder’s tag/site IDs (documentation here) an</p>

</div>

<div class="bs-docs-section demo-setup">

  <h1 id="line-item-setup">Line Item Setup</h1>

  <blockquote>
    <p>It can be helpful to understand <a href="">how Prebid.js helps simplify line item setup</a> before implementing these steps.</p>
  </blockquote>

  <p>In this section, we’ll help you start creating the line items to target the bids being passed into your ad server by prebid.js.</p>

  <p>Note: for the rest of this document, we assume you’ll create ≈10 line items in $0.50 increments from $0.50 to $5.</p>

  <h3 id="naming">Naming</h3>

  <p>Naming is fully customizable, and we recommend something simple like <code>Prebid_[PRICE_BUCKET]</code> to help you identify your various buckets. </p>

  <p>Examples: </p>

  <ul>
    <li>Line item 1 → name of “Prebid_0.50”</li>
    <li>Line item 2 → name of “Prebid_1.00”</li>
    <li>Line item 3 → name of “Prebid_1.50”</li>
    <li>Line item 4 → name of “Prebid_2.00”</li>
  </ul>

  <h3 id="setting-revenue-rate">Setting Revenue (Rate)</h3>

  <p>Rate, or line item revenue, depending on ad server naming conventions, should be equal to your price bucket on each line item. Why? You need to inform your ad server knows how much the programmatic bid is worth to you for decisioning and reporting.</p>

  <p>Examples: </p>

  <ul>
    <li>Prebid_0.50 → rate of $0.50</li>
    <li>Prebid_1.00 → rate of $1.00</li>
    <li>Prebid_1.50 → rate of $1.50</li>
    <li>Prebid_2.00 → rate of $2.00</li>
  </ul>

  <h3 id="sizes">Sizes</h3>

  <p>If your ad server requires size on the Line Item (like DoubleClick for Publishers), you’ll want to add all of your possible creative sizes to each line item.</p>

  <p>For example, if you have 300x250 and 728x90 on your page, each line item would have both sizes applied.</p>

  <div class="bs-callout">

    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#li-sizes-dfp" role="tab" data-toggle="tab">DFP</a></li>
    </ul>

<div class="tab-content">

<div role="tabpanel" class="tab-pane active" id="li-sizes-dfp">


        <p class="pb-md-img"><img id="pbjs-marked-front" src="http://prebid.org/assets/images/demo-setup/gpt-line-item-sizes.png" alt="GPT Line Item Sizes" /></p>
  


      </div>
</div>
</div>

  <h3 id="settings">Settings</h3>

  <div class="bs-callout">

    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#li-sizes-dfp" role="tab" data-toggle="tab">DFP</a></li>
    </ul>

<div class="tab-content">

<div role="tabpanel" class="tab-pane active" id="li-sizes-dfp">

        <p>The line item type should typically be “price priority” in DFP. That will enable the line items to compete on price. The goal can be set to ‘unlimited’ and with no end date.</p>


        <p class="pb-md-img" id="pbjs-marked-front">

          <script>
            var img = new Image();
            img.onload = function() {
              pbjsTimestamps.frontMarked = new Date().getTime();
            }
            img.src = 'http://prebid.org/assets/images/demo-setup/gpt-line-item-sizes.png';
            document.getElementById('pbjs-marked-front').appendChild(img);
          </script>

          <!-- <img  src="http://prebid.org/assets/images/demo-setup/gpt-line-item-sizes.png" alt="GPT Line Item Sizes" /> -->

        </p>

        <!-- 
        <p class="pb-md-img"><img src="http://prebid.org/assets/images/demo-setup/gpt-line-item-settings.png" alt="GPT Line Item Sizes" /></p> -->

      </div>
</div>
</div>



  <h3 id="targeting">Targeting</h3>

  <p>Each line item should have the following targets:</p>

  <ul>
    <li>Inventory – the ad units where prebid.js is running.</li>
    <li>
      <p>Custom Criteria / Key-Value – the price buckets (default key is hb_pb) added to your ad call’s query string by prebid.js. The targeted value should be of equivalent value to eCPM set at the line item.</p>

      <p>Example: for a line item setup to represent $1.00 bids, you’d set rate to $1.00 and target the key-value of hb_pb=1.00</p>

      <p><strong>Important</strong>: the price bucket value should always be at 2 decimal places. E.g. 1.00 not 1.</p>
    </li>
  </ul>

  <div class="bs-callout">

    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#li-sizes-dfp" role="tab" data-toggle="tab">DFP</a></li>
    </ul>

<div class="tab-content">

<div role="tabpanel" class="tab-pane active" id="li-sizes-dfp">

        <p><img src="http://prebid.org/assets/images/demo-setup/gpt-line-item-targeting.png" alt="GPT Line Item Sizes" /></p>

      </div>
</div>
</div>

  <h3 id="priorities">Priorities</h3>

  <p>We recommend setting the priority of pre-bid line items to the same level as other non-guaranteed line items, or in DoubleClick for Publishers, the same level as dynamic allocation competes.</p>

</div>

<div class="bs-docs-section">

  <p><a name="creative-setup"></a></p>

  <h1 id="creatives-setup">Creatives Setup</h1>

  <p>When your ad server determines a prebid.js line item won the impression, we need to return the winning creative ID to the page so Prebid.js can call the ad. To do this, simply add the creative below to your line items.</p>

  <div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="k">try</span><span class="p">{</span> <span class="nb">window</span><span class="p">.</span><span class="nx">top</span><span class="p">.</span><span class="nx">pbjs</span><span class="p">.</span><span class="nx">renderAd</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="s1">&#39;%%PATTERN:hb_adid%%&#39;</span><span class="p">);</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span><span class="cm">/*ignore*/</span><span class="p">}</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span></code></pre></div>

  <div class="bs-callout">

    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#li-sizes-dfp" role="tab" data-toggle="tab">DFP</a></li>
    </ul>

<div class="tab-content">

<div role="tabpanel" class="tab-pane active" id="li-sizes-dfp">

        <p>A couple of important points:</p>

        <ul>
          <li>
            <p>DoubleClick for Publishers (DFP) supports creative size override, which allows you to use one creative handle multiple sizes. Set each creative size to 1x1, then leverage DFP’s size override.</p>
          </li>
          <li>
            <p>Determine the maximum number of ad units your pages can have. Please duplicate and set up that number of creative for each line item. </p>

            <p>Why? The same creative cannot be served into more than 1 ad unit in a single DoubleClick for Publishers GPT request call. If you have 5 ad units on a page, your prebid line items would have ≥ 5 creatives of size 1x1 and the code snippet above.</p>
          </li>
        </ul>

      </div>
</div>
</div>

  <h3 id="step-1-new-creative">Step 1: New Creative</h3>

  <div class="bs-callout">

    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#li-sizes-dfp" role="tab" data-toggle="tab">DFP</a></li>
    </ul>

<div class="tab-content">

<div role="tabpanel" class="tab-pane active" id="li-sizes-dfp">

        <ul>
          <li>Create a new 3rd party tag creative.</li>
          <li>Add the code snippet above.</li>
          <li>Select 1x1 for creative size</li>
        </ul>

        <p class="pb-lg-img"><img src="http://prebid.org/assets/images/demo-setup/gpt-creative.png" alt="GPT Line Item Sizes" /></p>

      </div>
</div>
</div>

  <h3 id="step-2-add-the-creative-to-all-line-items">Step 2: Add the creative to all line items</h3>

  <div class="bs-callout">

    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#li-sizes-dfp" role="tab" data-toggle="tab">DFP</a></li>
    </ul>

<div class="tab-content">

<div role="tabpanel" class="tab-pane active" id="li-sizes-dfp">

        <p>Go to your line items and switch to the creatives tab. DFP will display a warning prompting you to upload creatives of the line items’ accepted sizes. Click add existing creative for a size and you’ll see the below screen.</p>

        <p class="pb-lg-img"><img src="http://prebid.org/assets/images/demo-setup/add-creative-to-line-item.png" alt="Add Creative to Line Item" /></p>

        <p>Click “Show all” next to the “filtering for creatives with size” in this screen. You should be able to find the creative you’ve just submitted in the previous step.</p>

      </div>
</div>
</div>

  <h3 id="step-3-add-more-sizes-to-the-creative">Step 3: Add more sizes to the creative</h3>

  <div class="bs-callout">

    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#li-sizes-dfp" role="tab" data-toggle="tab">DFP</a></li>
    </ul>

<div class="tab-content">

<div role="tabpanel" class="tab-pane active" id="li-sizes-dfp">

        <p>Step 2 has added one size override into the creative, but there’re still many sizes uncovered. Click into the creative, and you can find:</p>

        <p class="pb-md-img"><img src="http://prebid.org/assets/images/demo-setup/creative-size-override.png" alt="Creative Size Override" /></p>

        <p>Add all the sizes you need into the “Size overrides” box.</p>

      </div>
</div>
</div>

  <div class="bs-docs-section">

    <h1 id="query-strings">Query Strings</h1>

    <p>To simplify the line item setup, the default behavior of Prebid.js is to <a href="http://prebid.org/blog/how-to-simplify-line-item-setup#pbjs-sends-highest-price-only">send the highest price bid only to the ad server</a>. To run reporting such as:</p>

    <ul>
      <li>For bidder X, at what CPM does it fill?</li>
      <li>For bidder X, what’s the fill rate out of all the winning header bidding bids?</li>
    </ul>

    <p>It’s important to enable DFP report on free-form query strings (<a href="https://support.google.com/dfp_premium/answer/3108447?hl=en">DFP doc for report on custom targeting</a>). Follow the below steps: </p>

    <p class="pb-md-img"><img src="http://prebid.org/assets/images/demo-setup/gpt-query-strings.png" alt="GPT Query Strings for Header Bidding" /></p>

    <ol>
      <li>In DFP’s top navigation bar, go to Inventory.</li>
      <li>Click on Custom Targeting on the left.</li>
      <li>Add key <code>hb_bidder</code>.</li>
      <li>Add values for this key. The values should be the bidders’ bidder code <a href="bidders.html">documented here</a> under each bidder. You have to add the bidder code for the bidder that you want to run report on.</li>
    </ol>

  </div>

  <!--
<div class="bs-docs-section" markdown="1">

#Reporting

</div>

-->

  <!-- 
### You’re ready!

Once your test pages serve and you’re comfortable with pre-bid:

* Add more line items for higher granularity. Use the default setting for bidderSettings.
* Implement prebid.js in your site. -->

</div>


        
          
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'prebid';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();

    // setTimeout(function() {
    //   (function() {
    //       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    //       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    //       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    //   })();
    // }, 0)
    
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


        

      </div>

      <!-- Page navigation
      =========================================== -->
      <div class="col-md-3">

        <div class="bs-docs-sidebar hidden-print">


          <h5>Div-1, 300x250 or 300x600</h5>

          <!-- /19968336/pbjs-right1-300x250-300x600 -->
          <div id='div-gpt-ad-1438287399331-0'>
              <script type='text/javascript'>
                  googletag.cmd.push(function() { googletag.display('div-gpt-ad-1438287399331-0'); });
              </script>
          </div>

          <div id="pbjs-inpage-nav" role="complementary">
            <h5>This Page</h5>
            <ul class="nav bs-docs-sidenav">
            </ul>
          </div>

          <h5>Related Posts</h5>
          <ul class="nav bs-docs-sidenav">

            

              <li><a href="/blog/header-bidding-bidder-analysis">Bidder Analysis on price and latency</a></li>

            

              <li><a href="/blog/how-to-reduce-latency-of-header-bidding">How to reduce latency of header bidding</a></li>

            

              <li><a href="/blog/how-to-simplify-line-item-setup">How to simplify line item setup</a></li>

            

          </ul>

          <a class="back-to-top" href="#top">
            <i class="glyphicon glyphicon-chevron-up"></i> Back to top
          </a>
        </div>
      </div>
    </div>
  </div>



  <!-- Footer
  =========================================== -->
  <footer class="bs-docs-footer" role="contentinfo">
    <div class="container">
      <div class="bs-docs-social">
        <ul class="bs-docs-social-buttons">
        
          <li>
            <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=prebid&amp;repo=Prebid.js&amp;type=watch&amp;count=true" width="90" height="20" title="Star on GitHub"></iframe>
          </li>
          <li>
            <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=prebid&amp;repo=Prebid.js&amp;type=fork&amp;count=true" width="90" height="20" title="Fork on GitHub"></iframe>
          </li>
        
        
          <li>
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://prebid.org" data-count="horizontal" data-via="" data-text="Prebid.js" data-hashtags="prebidjs">Tweet</a>
          </li>
        
        
        
        
        </ul>
      </div>

      <p>
        Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License</a>,
        documentation under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
      </p>

      <p>
      Documentation template by <a href="http://getbootstrap.com/">Bootstrap team</a>, generated with <a href="https://github.com/mistic100/jekyll-bootstrap-doc">Jekyll Bootstrap Doc</a>.
      </p>

      <ul class="bs-docs-footer-links muted">
        <li>Currently v1.0.0</li>
      
        <li>&middot;</li>
        <li><a href="https://github.com/prebid/Prebid.js">GitHub</a></li>
      
        <li>&middot;</li>
        <li><a href="https://github.com/prebid/Prebid.js/issues?state=open">Issues</a></li>
      
        <li>&middot;</li>
        <li><a href="/questions.html">Contact Us</a></li>
      
      </ul>
    </div>
  </footer>


  <!-- Async scripts
  =========================================== -->
  

  
  <script>
    window.twttr = (function (d,s,id) {
      var t, js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return; js=d.createElement(s); js.id=id; js.async=1;
      js.src="https://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
      return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
    }(document, "script", "twitter-wjs"));
  </script>
  


</body>
</html>
